admin.controller("mathangController",["$scope","$http",function(n,t){function h(){e();r();s()}function e(){t.get(u).then(function(t){t.status==200&&(n.nhomMatHangs=t.data)})}function r(){n.selectedNhomMatHang.id==null?t.get(i).then(function(t){t.status==200&&(n.mathangs=t.data)}):t.get(i+"?att=idNhomMatHang&&value="+n.selectedNhomMatHang.id).then(function(t){t.status==200&&(n.mathangs=t.data)})}function s(){t.get(f).then(function(t){t.status==200&&(n.donvitinhs=t.data)})}var u,i,f,o;n.nhomMatHangs=[];n.nhomMatHang={};n.selectedNhomMatHang={};u="/API/DM_NhomMatHangAPI";n.mathangs=[];n.mathang={};n.selectedMatHangs=[];i="/API/DM_MatHangAPI";n.donvitinhs=[];n.donvitinh={};f="/API/DM_DonViTinhAPI";n.modifyNhomMatHang=!1;n.deleteNhomMatHang=!1;n.titlePopupModifyNhomMatHang="Thêm nhóm mặt hàng";n.popupModifyNhomMatHang={width:"auto",height:"auto",contentTemplate:"templateModifyNhomMatHang",showTitle:!0,resizeEnabled:!0,bindingOptions:{title:"titlePopupModifyNhomMatHang",visible:"modifyNhomMatHang"}};n.popupDeleteNhomMatHang={width:"auto",height:"auto",contentTemplate:"templateDeleteNhomMatHang",showTitle:!1,bindingOptions:{visible:"deleteNhomMatHang"}};n.modifyMatHang=!1;n.deleteMatHang=!1;n.titlePopupModifyMatHang="Thêm mặt hàng";n.popupModifyMatHang={width:"auto",height:"auto",contentTemplate:"templateModifyMatHang",showTitle:!0,resizeEnabled:!0,bindingOptions:{title:"titlePopupModifyMatHang",visible:"modifyMatHang"}};n.popupDeleteMatHang={width:"auto",height:"auto",contentTemplate:"templateDeleteMatHang",showTitle:!1,bindingOptions:{visible:"deleteMatHang"}};n.modifyDonViTinh=!1;n.titlePopupModifyDonViTinh="Thêm đơn vị tính";n.popupModifyDonViTinh={width:"auto",height:"auto",contentTemplate:"templateModifyDonViTinh",showTitle:!0,resizeEnabled:!0,bindingOptions:{title:"titlePopupModifyDonViTinh",visible:"modifyDonViTinh"}};n.controlNhomMatHang={ten:{showClearButton:!0,valueChangeEvent:"keyup",bindingOptions:{value:"nhomMatHang.ten"}}};n.controlMatHang={ten:{showClearButton:!0,valueChangeEvent:"keyup",bindingOptions:{value:"mathang.ten"}},nhomMatHang:{displayExpr:"ten",valueExpr:"id",searchEnabled:!0,noDataText:"Không có dữ liệu",placeholder:"Chọn ...",bindingOptions:{items:"nhomMatHangs",value:"mathang.idNhomMatHang"}},donvitinh:{displayExpr:"ten",valueExpr:"ten",searchEnabled:!0,noDataText:"Không có dữ liệu",placeholder:"Chọn ...",bindingOptions:{items:"donvitinhs",value:"mathang.donvitinh"}},addNhomMatHang:{icon:"plus",onClick:function(){n.AddNhomMatHang()}},addDonViTinh:{icon:"plus",onClick:function(){n.AddDonViTinh()}}};n.controlDonViTinh={ten:{showClearButton:!0,valueChangeEvent:"keyup",bindingOptions:{value:"donvitinh.ten"}}};n.listNhomMatHangs={bindingOptions:{dataSource:"nhomMatHangs"},height:"490",nextButtonText:"Xem thêm",onItemClick:function(t){n.selectedNhomMatHang=angular.copy(t.itemData);r()},onItemContextMenu:function(t){n.nhomMatHang=angular.copy(t.itemData)}};n.gridMatHangs={bindingOptions:{dataSource:"mathangs"},allowColumnResizing:!0,columnAutoWidth:!0,columnChooser:{emptyPanelText:"Kéo và thả cột muốn ẩn vào đây",enabled:!0,mode:"select",title:"Lựa chọn cột"},columnFixing:{enabled:!0,texts:{fix:"Cố định cột",leftPosition:"Bên trái",rightPosition:"Bên phải",unfix:"Hủy cố định"}},columns:[{alignment:"left",allowEditing:!1,caption:"ID",dataField:"id"},{alignment:"left",caption:"Tên mặt hàng",dataField:"ten",dataType:"string"},{alignment:"left",caption:"ĐVT",dataField:"donvitinh",dataType:"string"},{alignment:"right",caption:"Giá nhập",dataField:"dongia",format:{type:"fixedPoint",precision:0}},{alignment:"right",caption:"Tồn",dataField:"ton",format:{type:"fixedPoint",precision:3}},],editing:{mode:"cell",allowAdding:!1,allowDeleting:!1,allowUpdating:!1,texts:{addRow:"Thêm",cancelAllChanges:"Không thay đổi",cancelRowChanges:"Hủy",confirmDeleteMessage:"Bạn có chắc chắn muốn xóa?",deleteRow:"Xóa",editRow:"Sửa",saveAllChanges:"Lưu thay đổi",saveRowChanges:"Lưu",undeleteRow:"Không xóa",validationCancelChanges:"Hủy thay đổi"}},"export":{allowExportSelectedData:!0,enabled:!0,excelFilterEnabled:!0,excelWrapTextEnabled:!0,fileName:"Danh sách Mặt hàng",texts:{exportAll:"Xuất toàn bộ Dữ liệu",exportSelectedRows:"Xuất dữ liệu đang chọn",exportTo:"Trích xuất"}},filterRow:{applyFilterText:"Áp dụng bộ lọc",betweenEndText:"Kết thúc",betweenStartText:"Bắt đầu",resetOperationText:"Thiết lập lại",showAllText:"(Tất cả)",visible:!0},grouping:{contextMenuEnabled:!0,expandMode:"rowClick",texts:{groupByThisColumn:"Nhóm theo Cột này",groupContinuedMessage:"Tiếp tục từ trang trước",groupContinuesMessage:"Tiếp tục trên các trang tiếp theo",ungroup:"Bỏ nhóm",ungroupAll:"Bỏ tất cả nhóm"}},groupPanel:{emptyPanelText:"MẶT HÀNG",visible:!0},headerFilter:{texts:{cancel:"Hủy",emptyValue:"(Trống)",ok:"Đồng ý"},visible:!0},hoverStateEnabled:!0,loadPanel:{enabled:!0,text:"Đang tải ..."},noDataText:"Không có dữ liệu",pager:{infoText:"Trang {0} của {1}",showInfo:!0,showNavigationButtons:!0,showPageSizeSelector:!0,visible:!0},paging:{enabled:!0,pageIndex:0,pageSize:50},remoteOperations:{grouping:!1,summary:!1},rowAlternationEnabled:!1,scrolling:{preloadEnabled:!0},searchPanel:{placeholder:"Tìm kiếm ..."},selection:{mode:"multiple",showCheckBoxesMode:"onClick"},showBorders:!0,showRowLines:!0,sorting:{ascendingText:"Sắp xếp Tăng dần",clearText:"Xóa Sắp xếp",descendingText:"Sắp xếp Giảm dần"},summary:{texts:{count:"{0}",sum:"{0}"},groupItems:[{column:"id",summaryType:"count"}],totalItems:[{column:"id",summaryType:"count"}]},wordWrapEnabled:!1,onToolbarPreparing:function(t){var i=t.component;t.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{hint:"Thêm",icon:"add",type:"success",onClick:function(){n.AddMatHang()}}},{location:"after",widget:"dxButton",options:{hint:"Sửa",icon:"edit",type:"default",onClick:function(){n.EditMatHang()}}},{location:"after",widget:"dxButton",options:{hint:"Xóa",icon:"trash",type:"danger",onClick:function(){n.DeleteMatHang()}}},{location:"after",widget:"dxButton",options:{hint:"Load lại Dữ liệu",icon:"refresh",onClick:function(){r()}}})},onRowClick:function(t){var i=t.component;i.clickCount=i.clickCount?i.clickCount+1:1;i.clickCount==1?(i.lastClickTime=new Date,setTimeout(function(){i.lastClickTime=0;i.clickCount=0},350)):i.clickCount==2&&(new Date-i.lastClickTime<300&&(n.mathang=angular.copy(t.data),n.EditMatHang()),i.clickCount=0,i.lastClickTime=0)},onSelectionChanged:function(t){n.selectedMatHangs=angular.copy(t.selectedRowsData)}};o=[{value:"add",text:" Thêm",icon:"fa fa-plus"},{value:"edit",text:" Sửa",icon:"fa fa-pencil"},{value:"delete",text:" Xóa",icon:"fa fa-times"}];n.contextMenuNhomMatHang={dataSource:o,width:100,target:"#nhomMatHang",itemTemplate:function(n){var t=$("<div><\/div>");return n.icon&&t.append('<span class="'+n.icon+'"><span>'),t.append(n.text),t},onItemClick:function(t){if(!t.itemData.items)switch(t.itemData.value){case"add":n.AddNhomMatHang();break;case"edit":n.EditNhomMatHang();break;case"delete":n.DeleteNhomMatHang()}}};n.contextMenuMatHang={dataSource:o,width:100,target:"#mathang",itemTemplate:function(n){var t=$("<div><\/div>");return n.icon&&t.append('<span class="'+n.icon+'"><span>'),t.append(n.text),t},onItemClick:function(t){if(!t.itemData.items)switch(t.itemData.value){case"add":n.AddMatHang();break;case"edit":n.EditMatHang();break;case"delete":n.DeleteMatHang()}}};h();n.AddNhomMatHang=function(){n.nhomMatHang={};n.titlePopupModifyNhomMatHang="Thêm nhóm mặt hàng";n.modifyNhomMatHang=!0};n.EditNhomMatHang=function(){n.titlePopupModifyNhomMatHang="Sửa nhóm mặt hàng";n.modifyNhomMatHang=!0};n.SaveNhomMatHang=function(){angular.isDefined(n.nhomMatHang.id)?t.put(u+"/"+n.nhomMatHang.id,n.nhomMatHang).then(function(t){t.status==204?(e(),toastr.success("Thành công","Sửa"),n.modifyNhomMatHang=!1):toastr.error("Thất bại","Sửa")}):t.post(u,n.nhomMatHang).then(function(t){t.status==201?(e(),toastr.success("Thành công","Thêm"),n.modifyNhomMatHang=!1):toastr.error("Thất bại","Thêm")})};n.CancelSaveNhomMatHang=function(){n.modifyNhomMatHang=!1};n.DeleteNhomMatHang=function(){n.deleteNhomMatHang=!0};n.ConfirmDeleteNhomMatHang=function(){t.delete(u+"/"+n.nhomMatHang.id).then(function(t){t.status==200?(e(),toastr.success("Thành công","Xóa"),n.deleteNhomMatHang=!1):toastr.error("Thất bại","Xóa")})};n.CancelDeleteNhomMatHang=function(){n.deleteNhomMatHang=!1};n.GetAllMatHang=function(){n.selectedNhomMatHang={};r()};n.AddMatHang=function(){n.mathang={dongia:0,ton:0,donvitinh:"Hộp"};n.selectedNhomMatHang.id==null||(n.mathang.idNhomMatHang=n.selectedNhomMatHang.id);n.titlePopupModifyMatHang="Thêm mặt hàng";n.modifyMatHang=!0};n.EditMatHang=function(){n.selectedMatHangs.length==0?toastr.error("Chọn 1 dòng để sửa"):(n.mathang=angular.copy(n.selectedMatHangs[0]),n.titlePopupModifyMatHang="Sửa mặt hàng",n.modifyMatHang=!0)};n.SaveMatHang=function(){angular.isDefined(n.mathang.id)?t.put(i+"/"+n.mathang.id,n.mathang).then(function(t){t.status==204?(r(),toastr.success("Thành công","Sửa"),n.modifyMatHang=!1):toastr.error("Thất bại","Sửa")}):t.post(i,n.mathang).then(function(t){t.status==201?(r(),toastr.success("Thành công","Thêm"),n.modifyMatHang=!1):toastr.error("Thất bại","Thêm")})};n.CancelSaveMatHang=function(){n.modifyMatHang=!1};n.DeleteMatHang=function(){n.selectedMatHangs.length==0?toastr.error("Chọn dòng để xóa"):n.deleteMatHang=!0};n.ConfirmDeleteMatHang=function(){angular.forEach(n.selectedMatHangs,function(r){t.delete(i+"/"+r.id).then(function(t){t.status==200?angular.forEach(n.mathangs,function(t,i){r.id===t.id&&n.mathangs.splice(i,1)}):toastr.error("Thất bại","Xóa")})});toastr.success("Thành công","Xóa");n.deleteMatHang=!1};n.CancelDeleteMatHang=function(){n.deleteMatHang=!1};n.AddDonViTinh=function(){n.donvitinh={};n.titlePopupModifyDonViTinh="Thêm đơn vị tính";n.modifyDonViTinh=!0};n.SaveDonViTinh=function(){angular.isDefined(n.donvitinh.id)?t.put(f+"/"+n.donvitinh.id,n.donvitinh).then(function(t){t.status==204?(s(),toastr.success("Thành công","Sửa"),n.modifyDonViTinh=!1):toastr.error("Thất bại","Sửa")}):t.post(f,n.donvitinh).then(function(t){t.status==201?(s(),toastr.success("Thành công","Thêm"),n.modifyDonViTinh=!1):toastr.error("Thất bại","Thêm")})};n.CancelSaveDonViTinh=function(){n.modifyDonViTinh=!1}}]);